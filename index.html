<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Portfolio Data (fallback) -->
    <script src="js/portfolio-data.js"></script>
    <!-- Centralized personal info (single source of truth) -->
    <script src="js/personal-info.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #1e40af 100%);
            color: white;
            padding: 6rem 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
        }

        .header .subtitle {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .header .description {
            max-width: 700px;
            margin: 0 auto 2rem;
            font-size: 1.1rem;
            opacity: 0.85;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .social-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }

        /* Navigation */
        .nav {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .nav-link {
            color: #64748b;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            transition: color 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #0ea5e9;
        }

        /* Section */
        .section {
            max-width: 1400px;
            margin: 4rem auto;
            padding: 0 2rem;
            /* Ensure native scrolling accounts for the sticky nav height */
            scroll-margin-top: var(--scroll-offset, 96px);
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #64748b;
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .filter-search {
            flex: 1;
            max-width: 400px;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
        }

        .filter-category {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-category.active {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }

        .filter-category:hover {
            border-color: #0ea5e9;
        }

        /* Portfolio Grid */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .portfolio-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            opacity: 1;
        }

        .portfolio-card.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        .portfolio-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .portfolio-thumbnail {
            width: 100%;
            height: 280px;
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: #0ea5e9;
            position: relative;
            overflow: hidden;
        }

        .portfolio-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portfolio-content {
            padding: 2rem;
        }

        .portfolio-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.75rem;
        }

        .portfolio-description {
            color: #64748b;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .portfolio-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Design Badges */
        .design-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .design-badge {
            background: #f1f5f9;
            color: #475569;
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid #e2e8f0;
        }

        .design-badge.audience {
            background: #fef3c7;
            color: #92400e;
            border-color: #fcd34d;
        }

        .design-badge.style {
            background: #ede9fe;
            color: #7c3aed;
            border-color: #c4b5fd;
        }

        .design-badge.color {
            background: #dcfce7;
            color: #166534;
            border-color: #86efac;
        }

        .portfolio-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .portfolio-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #0ea5e9;
            font-weight: 600;
            text-decoration: none;
            transition: gap 0.3s;
        }

        .portfolio-link:hover {
            gap: 1rem;
        }

        /* About Section */
        .about-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .about-content p {
            font-size: 1.1rem;
            color: #475569;
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        /* Skill chips */
        .skill-chips {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .skill-chip {
            background: white;
            border: 1px solid #e6eef8;
            color: #1e293b;
            padding: 0.4rem 0.75rem;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 6px rgba(16,24,40,0.04);
        }

        /* Cards carousel */
        .cards-section { max-width: 1000px; margin: 2rem auto 0; }
        .cards-carousel {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            border-radius: 0.75rem;
        }

        .cards-carousel:focus { outline: 3px solid rgba(14,165,233,0.25); }

        .card-item {
            flex: 0 0 320px;
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 6px 20px rgba(2,6,23,0.08);
            scroll-snap-align: start;
            cursor: grab;
            user-select: none;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .card-item:active { cursor: grabbing; }

        .card-item:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(2,6,23,0.12); }

        .card-company { font-weight: 800; color: #0f172a; margin-bottom: 0.25rem; }
        .card-role { font-weight: 700; color: #0ea5e9; margin-bottom: 0.5rem; }
        .card-summary { color: #475569; font-size: 0.95rem; margin-bottom: 0.75rem; }
        /* Limit summary lines and add ellipsis */
        .card-summary {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            line-clamp: 3; /* standard property for compatibility */
            -webkit-line-clamp: 3; /* show up to 3 lines */
            overflow: hidden;
        }
        .card-tags { display:flex; gap:0.5rem; flex-wrap:wrap; }
        .card-tag { background:#eef2ff; color:#3730a3; padding:0.25rem 0.5rem; border-radius:999px; font-weight:600; font-size:0.8rem; }

        /* Hide scroll bar while preserving scroll support (thin fallback) */
        .cards-carousel::-webkit-scrollbar { height: 8px; }
        .cards-carousel::-webkit-scrollbar-thumb { background: rgba(2,6,23,0.08); border-radius: 999px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: #0ea5e9;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            background: #1e293b;
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            margin-top: 6rem;
        }

        .footer p {
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .portfolio-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1 id="personal-name"></h1>
        <p id="personal-title" class="subtitle"></p>
        <p id="personal-description" class="description"></p>
        <div class="social-links">
            <a id="email-link" class="social-btn" role="button">
                <i class="fas fa-envelope"></i> Email
            </a>
            <a id="linkedin-link" class="social-btn" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-linkedin"></i> LinkedIn
            </a>
            <a id="github-link" class="social-btn" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-github"></i> GitHub
            </a>
            <a id="bio-page-link" class="social-btn">
                <i class="fas fa-user"></i> Full Bio
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#about" class="nav-link">About</a>
            <a href="#portfolio" class="nav-link active">Portfolio</a>
            <a href="#contact" class="nav-link">Contact</a>
        </div>
    </nav>

    <!-- About Section -->
    <section id="about" class="section">
        <h2 class="section-title">About Me</h2>
        <div class="about-content">
            <p id="about-detailed-bio"></p>
            <p id="about-additional-bio"></p>
            <div id="about-skill-chips" class="skill-chips" aria-hidden="false"></div>

            <!-- Cards carousel: rendered from PERSONAL_INFO.cards -->
            <div class="cards-section" style="margin-top:1.5rem;">
                <h3 class="section-subtitle" style="margin-bottom:0.75rem;">Work & UI Experience</h3>
                <div id="about-cards-carousel" class="cards-carousel" tabindex="0" role="list" aria-label="Companies and UI experience"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div id="stat-experience" class="stat-number"></div>
                    <div class="stat-label">Years Experience</div>
                    <div class="skill-chips" id="stat-experience-skills"></div>
                </div>
                <div class="stat-card">
                    <div id="stat-design-variations" class="stat-number"></div>
                    <div class="stat-label">Design Variations</div>
                    <div class="skill-chips" id="stat-design-skills"></div>
                </div>
                <div class="stat-card">
                    <div id="stat-companies" class="stat-number"></div>
                    <div class="stat-label">Companies</div>
                    <div class="skill-chips" id="stat-companies-skills"></div>
                </div>
                <div class="stat-card">
                    <div id="stat-devices" class="stat-number"></div>
                    <div class="stat-label">Devices Secured</div>
                    <div class="skill-chips" id="stat-devices-skills"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="section">
        <h2 class="section-title">UI/UX Portfolio</h2>
        <p class="section-subtitle">
            A collection of website mockups and prototypes showcasing different 
            design approaches, color schemes, and user experiences across industries.
        </p>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <input type="text" id="search-input" class="filter-search" placeholder="Search by name, audience, style, or color..." />
            <div class="filter-category active" data-category="all">All Projects</div>
            <div class="filter-category" data-category="small-business">Small Business</div>
            <div class="filter-category" data-category="enterprise">Enterprise</div>
            <div class="filter-category" data-category="vc-growth">VC/Investment</div>
            <div class="filter-category" data-category="personal">Personal Branding</div>
            <div class="filter-category" data-category="cybersecurity">Cybersecurity</div>
            <div class="filter-category" data-category="ai-tools">AI/ML Tools</div>
            <div class="filter-category" data-category="fintech">FinTech</div>
            <div class="filter-category" data-category="friendly-design">Friendly Design</div>
            <div class="filter-category" data-category="professional-design">Professional</div>
            <div class="filter-category" data-category="creative-design">Creative</div>
            <div class="filter-category" data-category="angel-investors">Angel Investors</div>
            <div class="filter-category" data-category="pitch-deck">Pitch Decks</div>
            <div class="filter-category" data-category="vibrant-design">Vibrant Design</div>
            <div class="filter-category" data-category="minimal-design">Minimal Design</div>
        </div>

        <div class="portfolio-grid" id="portfolio-grid">
            <!-- Portfolio items will be loaded dynamically -->
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="section">
        <h2 class="section-title">Get In Touch</h2>
        <div class="about-content">
            <p>
                Interested in collaboration, have a project in mind, or just want to chat 
                about technology and design? I'd love to hear from you!
            </p>
            <div style="margin-top: 2rem;">
                <a id="contact-email-cta" class="social-btn" style="background: linear-gradient(135deg, #0ea5e9, #1e40af); border: none;">
                    <i class="fas fa-envelope"></i> Email Me
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p id="footer-copyright"></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">
            Built with HTML, CSS, and lots of ☕
        </p>
    </footer>

    <script>
        // Function to update personal information throughout the page
        function updatePersonalInfo() {
            // Update page title
            document.title = `${PERSONAL_INFO.name} - Portfolio`;
            
            // Update header name (prefer explicit ID; fallback to existing selector)
            const headerName = document.getElementById('personal-name') || document.querySelector('.header h1');
            if (headerName) headerName.textContent = PERSONAL_INFO.name;
            
            // Update header subtitle and description (prefer explicit IDs)
            const headerSubtitle = document.getElementById('personal-title') || document.querySelector('.header .subtitle');
            if (headerSubtitle) headerSubtitle.textContent = PERSONAL_INFO.title;

            const headerDesc = document.getElementById('personal-description') || document.querySelector('.header .description');
            if (headerDesc) headerDesc.textContent = PERSONAL_INFO.bio.short;
            
            // Update about section detailed and additional bios (prefer IDs)
            const aboutDetailed = document.getElementById('about-detailed-bio');
            if (aboutDetailed) {
                // Clear and render paragraphs for improved readability
                aboutDetailed.innerHTML = '';
                const paras = (PERSONAL_INFO.bio && PERSONAL_INFO.bio.paragraphs) || [];
                paras.forEach(p => {
                    const el = document.createElement('p');
                    el.textContent = p;
                    aboutDetailed.appendChild(el);
                });
            }

            const aboutAdditional = document.getElementById('about-additional-bio');
            if (aboutAdditional) aboutAdditional.textContent = PERSONAL_INFO.bio.additional;
            
            // Update email and social links via explicit IDs
            const emailLink = document.getElementById('email-link');
            if (emailLink) {
                emailLink.href = `mailto:${PERSONAL_INFO.email}`;
                emailLink.setAttribute('aria-label', `Email ${PERSONAL_INFO.name}`);
            }

            const contactEmailCta = document.getElementById('contact-email-cta');
            if (contactEmailCta) {
                contactEmailCta.href = `mailto:${PERSONAL_INFO.email}`;
                contactEmailCta.setAttribute('aria-label', `Email ${PERSONAL_INFO.name}`);
            }

            const linkedinLink = document.getElementById('linkedin-link');
            if (linkedinLink) {
                linkedinLink.href = PERSONAL_INFO.social.linkedin;
            }

            const githubLink = document.getElementById('github-link');
            if (githubLink) {
                githubLink.href = PERSONAL_INFO.social.github;
            }

            const bioLink = document.getElementById('bio-page-link');
            if (bioLink) {
                bioLink.href = PERSONAL_INFO.social.bioPage;
            }
            
            // Update footer copyright (use current year)
            const footerCopyright = document.getElementById('footer-copyright') || document.querySelector('.footer p');
            if (footerCopyright) {
                const year = new Date().getFullYear();
                footerCopyright.textContent = `© ${year} ${PERSONAL_INFO.name}. All rights reserved.`;
            }
            
            // Update stats via explicit IDs
            const statExperience = document.getElementById('stat-experience');
            if (statExperience) statExperience.textContent = PERSONAL_INFO.stats.experience;
            const statDesign = document.getElementById('stat-design-variations');
            if (statDesign) statDesign.textContent = PERSONAL_INFO.stats.designVariations;
            const statCompanies = document.getElementById('stat-companies');
            if (statCompanies) statCompanies.textContent = PERSONAL_INFO.stats.companies;
            const statDevices = document.getElementById('stat-devices');
            if (statDevices) statDevices.textContent = PERSONAL_INFO.stats.devicesSecured;

            // Render skill chips under About
            const aboutChips = document.getElementById('about-skill-chips');
            if (aboutChips && Array.isArray(PERSONAL_INFO.skills)) {
                aboutChips.innerHTML = PERSONAL_INFO.skills.map(s => `<span class="skill-chip">${s.name}</span>`).join('');
            }

            // Render related skills under stat cards if available
            const related = PERSONAL_INFO.stats && PERSONAL_INFO.stats.related ? PERSONAL_INFO.stats.related : {};
            const statMap = {
                experience: 'stat-experience-skills',
                designVariations: 'stat-design-skills',
                companies: 'stat-companies-skills',
                devicesSecured: 'stat-devices-skills'
            };

            Object.keys(statMap).forEach(key => {
                const el = document.getElementById(statMap[key]);
                if (!el) return;
                const names = related[key] || [];
                el.innerHTML = names.map(n => `<span class="skill-chip">${n}</span>`).join('');
            });
        }

        // Helper function to create individual portfolio card
        function createPortfolioCard(project) {
            const card = document.createElement('div');
            card.className = 'portfolio-card';
            card.setAttribute('data-categories', project.category.join(' '));
            card.setAttribute('data-tags', project.tags.join(' ').toLowerCase());
            card.setAttribute('data-title', project.title.toLowerCase());
            
            const linkHTML = `<a href="${project.url}" class="portfolio-link" target="_blank">
                View Design <i class="fas fa-arrow-right"></i>
            </a>`;
            
            const tagsHTML = project.tags.map(tag => 
                `<span class="tag">${tag}</span>`
            ).join('');
            
            const thumbnailContent = project.screenshot ? 
                `<img src="${project.screenshot}" alt="${project.title} Screenshot" 
                      onerror="this.onerror=null; this.parentElement.innerHTML='<i class=\\"${project.icon}\\"></i>';">` :
                `<i class="${project.icon}"></i>`;
            
            const designBadges = [];
            if (project.targetAudience) designBadges.push(`<span class="design-badge audience">👥 ${project.targetAudience}</span>`);
            if (project.designStyle) designBadges.push(`<span class="design-badge style">🎨 ${project.designStyle}</span>`);
            if (project.colorScheme) designBadges.push(`<span class="design-badge color">🎨 ${project.colorScheme}</span>`);
            
            card.innerHTML = `
                <div class="portfolio-thumbnail">
                    ${thumbnailContent}
                </div>
                <div class="portfolio-content">
                    <h3 class="portfolio-title">${project.title}</h3>
                    <p class="portfolio-description">${project.description}</p>
                    ${designBadges.length > 0 ? `<div class="design-badges">${designBadges.join('')}</div>` : ''}
                    <div class="portfolio-tags">
                        ${tagsHTML}
                    </div>
                    <div class="portfolio-links">
                        ${linkHTML}
                    </div>
                </div>
            `;
            
            return card;
        }

        // Enhanced portfolio card generation with screenshot support
        async function generatePortfolioCards() {
            const grid = document.getElementById('portfolio-grid');
            grid.innerHTML = ''; // Clear existing cards
            
            // Load projects from Portfolio Manager
            const projects = await portfolioManager.loadProjects();
            
            projects.forEach(project => {
                const card = createPortfolioCard(project);
                grid.appendChild(card);
            });
            
            // Reinitialize filters after cards are generated
            setupFilters();
        }

        // Filter functionality
        function setupFilters() {
            const searchInput = document.getElementById('search-input');
            const categoryButtons = document.querySelectorAll('.filter-category');
            // const portfolioCards = document.querySelectorAll('.portfolio-card'); // unused
            
            let activeCategory = 'all';
            
            // Category filter
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    activeCategory = button.getAttribute('data-category');
                    filterProjects();
                });
            });
            
            // Search filter
            searchInput.addEventListener('input', filterProjects);
            
            function filterProjects() {
                const searchTerm = searchInput.value.toLowerCase();
                const grid = document.getElementById('portfolio-grid');
                
                // Get all projects data
                const allProjects = portfolioManager.projects || [];
                
                // Filter projects that match criteria
                const matchingProjects = allProjects.filter(project => {
                    const matchesCategory = activeCategory === 'all' || 
                        (project.category && project.category.includes(activeCategory));
                    const matchesSearch = !searchTerm || 
                        project.title.toLowerCase().includes(searchTerm) ||
                        project.description.toLowerCase().includes(searchTerm) ||
                        project.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    
                    return matchesCategory && matchesSearch;
                });
                
                // Clear grid and regenerate with filtered projects only
                grid.innerHTML = '';
                
                matchingProjects.forEach(project => {
                    const card = createPortfolioCard(project);
                    grid.appendChild(card);
                });
            }
        }

        // Store reference to portfolioManager in setupFilters
        // setupFilters.portfolioManager = portfolioManager;

        // Enhanced Automatic Portfolio Detection System
        class PortfolioManager {
            constructor() {
                this.projects = [];
                this.categories = [];
                this.initialized = false;
            }

            async autoDetectProjects() {
                try {
                    // Try to load from registry first (auto-generated)
                    console.log('Loading portfolio from registry...');
                    const response = await fetch('js/portfolio-registry.json');
                    if (response.ok) {
                        const registry = await response.json();
                        console.log('Registry loaded successfully:', registry.projects.length, 'projects');
                        return registry.projects;
                    } else {
                        console.log('Registry fetch failed with status:', response.status);
                    }
                } catch (error) {
                    console.log('Registry fetch error:', error.message);
                }

                try {
                    // Fallback to static portfolio data
                    console.log('Trying portfolio-data.js fallback...');
                    const dataResponse = await fetch('js/portfolio-data.js');
                    if (dataResponse.ok) {
                        console.log('portfolio-data.js loaded, checking for portfolioData...');
                        // Try to access portfolioData from the loaded script
                        if (typeof portfolioData !== 'undefined' && portfolioData.projects) {
                            console.log('Using portfolioData.projects:', portfolioData.projects.length, 'projects');
                            return portfolioData.projects;
                        } else {
                            console.log('portfolioData not found in global scope');
                        }
                    } else {
                        console.log('portfolio-data.js fetch failed with status:', dataResponse.status);
                    }
                } catch (error) {
                    console.log('Portfolio data fetch error:', error.message);
                }

                // Check if the registry file exists by trying a different approach
                console.log('Trying direct registry check...');
                try {
                    const registryCheck = await fetch('./js/portfolio-registry.json');
                    if (registryCheck.ok) {
                        const registryData = await registryCheck.json();
                        console.log('Direct registry check successful:', registryData.projects.length, 'projects');
                        return registryData.projects;
                    }
                } catch (error) {
                    console.log('Direct registry check failed:', error.message);
                }

                // Final fallback with helpful diagnostic message
                console.log('All loading methods failed, using error fallback');
                return [
                    {
                        id: 'loading-failed',
                        title: 'Portfolio Loading Failed',
                        description: 'Unable to load portfolio data. Please check browser console for details and ensure js/portfolio-registry.json exists and is accessible.',
                        icon: 'fas fa-exclamation-triangle',
                        tags: ['Error', 'Loading Failed'],
                        category: ['system'],
                        url: '#',
                        targetAudience: 'Debug Info',
                        designStyle: 'Error State',
                        colorScheme: 'Error Red'
                    },
                    {
                        id: 'check-files',
                        title: 'Check Configuration Files',
                        description: 'Ensure these files exist: 1) js/portfolio-registry.json with project data, 2) js/portfolio-data.js as fallback. Check browser Network tab for 404 errors.',
                        icon: 'fas fa-tools',
                        tags: ['Configuration', 'Debug', 'Setup'],
                        category: ['system'],
                        url: '#',
                        targetAudience: 'Developer',
                        designStyle: 'Debug Helper',
                        colorScheme: 'Warning Orange'
                    }
                ];
            }

            async loadProjects() {
                if (this.initialized) {
                    return this.projects;
                }

                this.projects = await this.autoDetectProjects();
                this.initialized = true;
                
                console.log(`Portfolio Manager: Loaded ${this.projects.length} projects`);
                
                // Update stats
                this.updateStats();
                
                return this.projects;
            }

            updateStats() {
                const statElement = document.querySelector('.stat-card .stat-number');
                if (statElement && statElement.textContent.includes('+')) {
                    // Update the project count in the stats
                    const projectCount = this.projects.length;
                    const statsCards = document.querySelectorAll('.stat-number');
                    if (statsCards.length >= 2) {
                        statsCards[1].textContent = `${projectCount}+`;
                    }
                }
            }

            

            getProjectsByCategory(category) {
                if (category === 'all') {
                    return this.projects;
                }
                return this.projects.filter(project => 
                    project.category && project.category.includes(category)
                );
            }

            searchProjects(searchTerm) {
                if (!searchTerm) {
                    return this.projects;
                }
                
                const term = searchTerm.toLowerCase();
                return this.projects.filter(project => 
                    project.title.toLowerCase().includes(term) ||
                    project.description.toLowerCase().includes(term) ||
                    project.tags.some(tag => tag.toLowerCase().includes(term))
                );
            }
        }

        // Initialize Portfolio Manager
        const portfolioManager = new PortfolioManager();

        // Navigation behavior and scroll-spy will be set up by setupNavScrollSpy()

        // Debug function to test file access
        async function debugFileAccess() {
            console.log('=== Portfolio Debug Info ===');
            console.log('Current URL:', window.location.href);
            console.log('Base URL:', window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1));
            
            const baseUrl = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
            const registryUrl = baseUrl + 'js/portfolio-registry.json';
            console.log('Trying to access:', registryUrl);
            
            try {
                const response = await fetch(registryUrl);
                console.log('Registry response status:', response.status);
                console.log('Registry response headers:', response.headers);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Registry data loaded successfully:', data);
                } else {
                    console.log('Registry response not ok:', await response.text());
                }
            } catch (error) {
                console.error('Registry fetch error:', error);
            }
        }

        

        // Enhanced initialization with loading states
        document.addEventListener('DOMContentLoaded', async () => {
            // Update personal information from single source
            updatePersonalInfo();
            // Initialize simple navigation click handlers (no scroll-spy)
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        // Update active link
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
            
            // Run debug check
            await debugFileAccess();
            
            // Show loading state
            const grid = document.getElementById('portfolio-grid');
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #0ea5e9; margin-bottom: 1rem;"></i>
                    <p style="color: #64748b; font-size: 1.1rem;">Loading portfolio projects...</p>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 1rem;">Check browser console for loading details</p>
                </div>
            `;
            
            try {
                // Load and generate portfolio cards
                await generatePortfolioCards();
                // Layout changed after generating cards — if you add scroll-spy later, recompute offsets here.
                console.log('Portfolio loaded successfully');
            } catch (error) {
                console.error('Error loading portfolio:', error);
                
                // Show detailed error state
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #ef4444; margin-bottom: 1rem;"></i>
                        <p style="color: #64748b; font-size: 1.1rem;">Error loading portfolio</p>
                        <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 1rem;">Check browser console for details. Error: ${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #0ea5e9; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                            Retry Loading
                        </button>
                    </div>
                `;
            }

            // Render company cards carousel from PERSONAL_INFO.cards
            function renderCardsCarousel() {
                const carousel = document.getElementById('about-cards-carousel');
                if (!carousel || !Array.isArray(PERSONAL_INFO.cards)) return;

                carousel.innerHTML = PERSONAL_INFO.cards.map(card => `
                    <article class="card-item" role="listitem" tabindex="0" data-id="${card.id}">
                        <div class="card-company">${card.company}</div>
                        <div class="card-role">${card.role}</div>
                        <div class="card-summary">${card.summary}</div>
                        <div class="card-tags">
                            ${card.uiTags.map(t => `<span class="card-tag">${t}</span>`).join('')}
                        </div>
                    </article>
                `).join('');

                // Interaction: drag-to-scroll + pause-on-hover + keyboard support + autoplay
                const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                let isDragging = false;
                let startX, scrollLeft;
                let autoplayTimer = null;

                // Drag handlers
                carousel.addEventListener('pointerdown', e => {
                    isDragging = true;
                    carousel.classList.add('dragging');
                    startX = e.clientX || e.touches && e.touches[0].clientX;
                    scrollLeft = carousel.scrollLeft;
                    carousel.setPointerCapture(e.pointerId);
                });

                carousel.addEventListener('pointermove', e => {
                    if (!isDragging) return;
                    const x = e.clientX || (e.touches && e.touches[0].clientX);
                    const dx = x - startX;
                    carousel.scrollLeft = scrollLeft - dx;
                });

                const stopDragging = e => {
                    isDragging = false;
                    try { carousel.releasePointerCapture && carousel.releasePointerCapture(e.pointerId); } catch (err) {}
                    carousel.classList.remove('dragging');
                };

                carousel.addEventListener('pointerup', stopDragging);
                carousel.addEventListener('pointercancel', stopDragging);
                carousel.addEventListener('pointerleave', stopDragging);

                // Pause autoplay on hover/focus
                carousel.addEventListener('mouseenter', stopAutoplay);
                carousel.addEventListener('focusin', stopAutoplay);
                carousel.addEventListener('mouseleave', startAutoplayIfNeeded);
                carousel.addEventListener('focusout', startAutoplayIfNeeded);

                // Keyboard navigation: left/right to scroll by card width
                carousel.addEventListener('keydown', e => {
                    const key = e.key;
                    const cardWidth = carousel.querySelector('.card-item')?.offsetWidth || 320;
                    if (key === 'ArrowRight') {
                        carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
                        e.preventDefault();
                    } else if (key === 'ArrowLeft') {
                        carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
                        e.preventDefault();
                    }
                });

                // Smooth back-and-forth autoplay using requestAnimationFrame
                let rafId = null;
                let lastTime = null;
                let direction = 1; // 1 = forward, -1 = backward
                const speed = 40; // pixels per second
                let resumeTimer = null;

                function animateFrame(timestamp) {
                    if (!lastTime) lastTime = timestamp;
                    const dt = (timestamp - lastTime) / 1000; // seconds
                    lastTime = timestamp;
                    if (!isDragging) {
                        const maxScroll = carousel.scrollWidth - carousel.clientWidth;
                        if (maxScroll > 1) {
                            carousel.scrollLeft += direction * speed * dt;
                            if (carousel.scrollLeft <= 0) { carousel.scrollLeft = 0; direction = 1; }
                            else if (carousel.scrollLeft >= maxScroll) { carousel.scrollLeft = maxScroll; direction = -1; }
                        }
                    }
                    rafId = requestAnimationFrame(animateFrame);
                }

                function startAutoplay() {
                    if (prefersReducedMotion) return;
                    stopAutoplay();
                    lastTime = null;
                    rafId = requestAnimationFrame(animateFrame);
                }

                function stopAutoplay() {
                    if (rafId) { cancelAnimationFrame(rafId); rafId = null; lastTime = null; }
                }

                function scheduleResume(delay = 1500) {
                    if (resumeTimer) clearTimeout(resumeTimer);
                    resumeTimer = setTimeout(() => { startAutoplay(); resumeTimer = null; }, delay);
                }

                function cancelResume() { if (resumeTimer) { clearTimeout(resumeTimer); resumeTimer = null; } }

                // Pause autoplay immediately on interaction
                carousel.addEventListener('pointerdown', e => {
                    stopAutoplay();
                    cancelResume();
                });

                carousel.addEventListener('pointerup', e => {
                    // schedule resume after short idle
                    scheduleResume(1600);
                });

                // Also pause on hover/focus and resume after idle
                carousel.addEventListener('mouseenter', () => { stopAutoplay(); cancelResume(); });
                carousel.addEventListener('focusin', () => { stopAutoplay(); cancelResume(); });
                carousel.addEventListener('mouseleave', () => { scheduleResume(1200); });
                carousel.addEventListener('focusout', () => { scheduleResume(1200); });

                // Start autoplay if allowed and not reduced-motion
                if (!prefersReducedMotion) startAutoplay();
            }

            // Render after personal info updated
            renderCardsCarousel();
        });
    </script>
</body>
</html>