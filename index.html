<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Portfolio Data (fallback) -->
    <script src="js/portfolio-data.js"></script>
    <!-- Centralized personal info (single source of truth) -->
    <script src="js/personal-info.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #1e40af 100%);
            color: white;
            /* Reduced vertical padding to make the hero more compact */
            padding: 3.5rem 2rem;
            text-align: center;
        }

        .header h1 {
            /* Slightly smaller and more balanced for desktop and mobile */
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 0.75rem;
        }

        .header .subtitle {
            font-size: 1.25rem;
            opacity: 0.95;
            margin-bottom: 1.25rem;
        }

        .header .description {
            max-width: 700px;
            margin: 0 auto 1.5rem;
            font-size: 1.05rem;
            opacity: 0.9;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 0.5rem;
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .social-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }

        /* Navigation */
        .nav {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .nav-link {
            color: #64748b;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            transition: color 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #0ea5e9;
        }

        /* Section */
        .section {
            max-width: 1400px;
            margin: 4rem auto;
            padding: 0 2rem;
            /* Ensure native scrolling accounts for the sticky nav height */
            scroll-margin-top: var(--scroll-offset, 96px);
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #64748b;
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .filter-search {
            flex: 1;
            max-width: 400px;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            background: white;
        }

        .filter-category {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-category.active {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }

        .filter-category:hover {
            border-color: #0ea5e9;
        }

        /* Portfolio Grid */
        .portfolio-grid {
            display: grid;
            /* Allow smaller cards on tablets and narrow screens */
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .portfolio-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            opacity: 1;
        }

        .portfolio-card.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }

        .portfolio-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .portfolio-thumbnail {
            width: 100%;
            height: 280px;
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: #0ea5e9;
            position: relative;
            overflow: hidden;
        }

        .thumbnail-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            color: rgba(14,165,233,0.9);
            font-size: 3.25rem;
            background: linear-gradient(135deg, #eaf6ff 0%, #eef9ff 100%);
        }

    /* Project detail modal */
    .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .modal[aria-hidden="false"] { display: flex; }

    .modal-overlay {
        position: absolute;
        inset: 0;
        background: rgba(2,6,23,0.6);
        backdrop-filter: blur(4px);
    }

    .modal-content {
        position: relative;
        background: white;
        /* Slightly wider for desktop but keep responsive */
        width: min(1300px, 96%);
        max-height: 92vh;
        border-radius: 12px;
        /* Keep modal itself non-scrollable; make panels scrollable instead */
        overflow: visible;
        box-shadow: 0 20px 60px rgba(2,6,23,0.4);
        padding: 1.25rem;
        z-index: 2010;
        display: grid;
        grid-template-columns: 1fr 420px; /* larger detail panel for readability */
        gap: 1rem;
        transform: translateY(8px);
        opacity: 0;
        transition: transform 220ms ease, opacity 220ms ease;
    }

    /* Right panel scroll and tabs */
    .modal-details {
        display: flex;
        flex-direction: column;
        /* keep modal-details pinned and let inner content scroll */
        max-height: calc(92vh - 32px);
        overflow: hidden;
        padding-left: 0.5rem;
    }

    .modal-header { margin-bottom: 0.5rem; }

    .tab-list { display:flex; gap:0.5rem; margin-bottom:0.5rem; }
    .tab { background: transparent; border: 1px solid #e6eef8; padding: 0.4rem 0.6rem; border-radius: 8px; cursor: pointer; font-weight:700; color:#0f172a; }
    .tab[aria-selected="true"] { background: linear-gradient(135deg,#0ea5e9,#1e40af); color:white; border-color: transparent; }

    .tab-panels { overflow: visible; padding-right: 0.5rem; }
    .tab-panel { padding-bottom: 1rem; }
    /* Only the details content (inside each panel) should scroll */
    .modal-details-content { max-height: calc(92vh - 160px); overflow:auto; padding-right:0.5rem; }

    .modal-tags .tag { display:inline-block; margin:0.25rem 0.25rem 0.25rem 0; }

    @media (max-width: 900px) {
        .modal-content { grid-template-columns: 1fr; }
        .modal-details { max-height: 60vh; }
        .modal-body { max-height: 40vh; overflow: auto; }
    }

    .modal-close {
        position: absolute;
        right: 0.5rem;
        top: 0.5rem;
        background: transparent;
        border: none;
        font-size: 1.75rem;
        color: #475569;
        cursor: pointer;
    }

    .modal-body-img {
        width: 100%;
        height: 100%;
        max-height: 70vh;
        object-fit: contain;
        border-radius: 8px;
        background: #f8fafc;
    }

    /* Ensure the left image column doesn't force modal scrolling on tall content */
    .modal-body { display:flex; flex-direction:column; gap:0.5rem; align-items:stretch; justify-content:center; max-height: calc(92vh - 40px); overflow: hidden; }

    .modal-details {
        padding: 0.25rem 0.5rem;
    }

    /* Read-more clamp utility */
    .clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .read-more-toggle { background: transparent; border: none; color: #0ea5e9; font-weight: 700; cursor: pointer; padding: 0.15rem 0.25rem; }

    .modal-meta { display: flex; flex-direction: column; gap: 0.75rem; }
    .modal-meta h4 { margin: 0 0 0.25rem 0; font-size: 0.95rem; }
    .modal-tags { display:flex; gap:0.4rem; flex-wrap:wrap; margin-top:0.5rem; }

    .modal-actions { margin-top: 1rem; display:flex; gap:0.5rem; }

    @media (max-width: 900px) {
        .modal-content { grid-template-columns: 1fr; }
        .modal-content { max-height: 85vh; }
    }

        /* When modal is visible, animate content in */
        .modal[aria-hidden="false"] .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        /* CTA button inside modal */
        .modal .portfolio-link {
            padding: 0.5rem 0.75rem;
            background: linear-gradient(135deg,#0ea5e9,#1e40af);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 700;
        }

        .modal .portfolio-link:hover { opacity: 0.95; }

        /* Modal footer CTA visually floats to bottom-right of modal-content
           while remaining outside the scrollable tab panels in the DOM */
        .modal-footer {
            position: absolute;
            right: 20px;
            bottom: 20px;
            z-index: 2050;
            display: block;
            pointer-events: none; /* let children control pointer events */
        }
        .modal-footer .modal-cta {
            pointer-events: auto;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            border-radius: 10px;
            background: linear-gradient(135deg,#0ea5e9,#1e40af);
            color: white;
            text-decoration: none;
            font-weight: 800;
            box-shadow: 0 6px 20px rgba(2,6,23,0.12);
        }
        @media (max-width: 900px) {
            .modal-footer { right: 12px; bottom: 12px; }
            .modal-footer .modal-cta { padding: 0.5rem 0.9rem; }
        }

        .portfolio-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .portfolio-content {
            padding: 2rem;
        }

        .portfolio-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.75rem;
        }

        .portfolio-description {
            color: #64748b;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .portfolio-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Design Badges */
        .design-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            font-size: 0.8rem;
        }

        .design-badge {
            background: #f1f5f9;
            color: #475569;
            padding: 0.2rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid #e2e8f0;
        }

        .design-badge.audience {
            background: #fef3c7;
            color: #92400e;
            border-color: #fcd34d;
        }

        .design-badge.style {
            background: #ede9fe;
            color: #7c3aed;
            border-color: #c4b5fd;
        }

        .design-badge.color {
            background: #dcfce7;
            color: #166534;
            border-color: #86efac;
        }

        .portfolio-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .portfolio-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #0ea5e9;
            font-weight: 600;
            text-decoration: none;
            transition: gap 0.3s;
        }

        .portfolio-link:hover {
            gap: 1rem;
        }

        /* About Section */
        .about-content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .about-content p {
            font-size: 1.1rem;
            color: #475569;
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        /* Skill chips */
        .skill-chips {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .skill-chip {
            background: white;
            border: 1px solid #e6eef8;
            color: #1e293b;
            padding: 0.4rem 0.75rem;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 6px rgba(16,24,40,0.04);
        }

        /* Cards carousel */
        .cards-section { max-width: 1000px; margin: 2rem auto 0; }
        .cards-carousel {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            border-radius: 0.75rem;
        }

        .cards-carousel:focus { outline: 3px solid rgba(14,165,233,0.25); }

        .card-item {
            flex: 0 0 320px;
            background: white;
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 6px 20px rgba(2,6,23,0.08);
            scroll-snap-align: start;
            cursor: grab;
            user-select: none;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .card-item:active { cursor: grabbing; }

        .card-item:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(2,6,23,0.12); }

        .card-company { font-weight: 800; color: #0f172a; margin-bottom: 0.25rem; }
        .card-role { font-weight: 700; color: #0ea5e9; margin-bottom: 0.5rem; }
        .card-summary { color: #475569; font-size: 0.95rem; margin-bottom: 0.75rem; }
        /* Limit summary lines and add ellipsis */
        .card-summary {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            line-clamp: 6; /* allow up to 6 lines */
            -webkit-line-clamp: 6; /* show up to 6 lines */
            overflow: hidden;
        }
        .card-tags { display:flex; gap:0.5rem; flex-wrap:wrap; }
        .card-tag { background:#eef2ff; color:#3730a3; padding:0.25rem 0.5rem; border-radius:999px; font-weight:600; font-size:0.8rem; }

        /* Hide scroll bar while preserving scroll support (thin fallback) */
        .cards-carousel::-webkit-scrollbar { height: 8px; }
        .cards-carousel::-webkit-scrollbar-thumb { background: rgba(2,6,23,0.08); border-radius: 999px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
            margin-top: 3rem;
        }

        /* Skills card grid replaces the old stats row */
        .skills-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            margin-top: 2rem;
        }

        .skill-category-card {
            background: white;
            padding: 1.25rem;
            border-radius: 0.75rem;
            box-shadow: 0 6px 20px rgba(2,6,23,0.06);
            min-height: 140px;
        }

        .skill-category-title { font-weight: 800; color: #0f172a; margin-bottom: 0.5rem; }
        /* Skill list: vertical stacked pills with left dot markers to match design */
        .skill-items {
            list-style: none;
            padding: 0;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            align-items: center;
            width: 86%; /* small inset from card edges */
        }

        .skill-item {
            background: #eef6fb; /* pale blue-ish background */
            color: #0f172a;
            padding: 0.6rem 1.25rem;
            border-radius: 28px;
            font-weight: 700;
            font-size: 0.92rem;
            width: 100%;
            text-align: center;
            position: relative;
            box-shadow: 0 1px 0 rgba(255,255,255,0.6) inset;
        }

        /* small dot marker on left edge of the list area (outside pills) */
        /* dot marker removed by request */

        /* make sure the container cards position relative so the ::before can position correctly */
        .skill-category-card { position: relative; }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: #0ea5e9;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #64748b;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            background: #1e293b;
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            margin-top: 6rem;
        }

        .footer p {
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .portfolio-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1 id="personal-name"></h1>
        <p id="personal-title" class="subtitle"></p>
        <p id="personal-description" class="description"></p>
        <div class="social-links">
            <a id="email-link" class="social-btn" role="button">
                <i class="fas fa-envelope"></i> Email
            </a>
            <a id="linkedin-link" class="social-btn" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-linkedin"></i> LinkedIn
            </a>
            <a id="github-link" class="social-btn" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-github"></i> GitHub
            </a>
            <a id="bio-page-link" class="social-btn">
                <i class="fas fa-user"></i> Full Bio
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#portfolio" class="nav-link active">Portfolio</a>
            <a href="#about" class="nav-link">About</a>
            <a href="#contact" class="nav-link">Contact</a>
        </div>
    </nav>

    <!-- Portfolio Section -->
    <section id="portfolio" class="section">
        <h2 class="section-title">UI/UX Portfolio</h2>
        <p class="section-subtitle">
            A collection of website mockups and prototypes showcasing different 
            design approaches, color schemes, and user experiences across industries.
        </p>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <input type="text" id="search-input" class="filter-search" placeholder="Search by name, audience, style, or color..." />
            <div class="filter-category active" data-category="all">All Projects</div>
            <div class="filter-category" data-category="small-business">Small Business</div>
            <div class="filter-category" data-category="enterprise">Enterprise</div>
            <div class="filter-category" data-category="vc-growth">VC/Investment</div>
            <div class="filter-category" data-category="personal">Personal Branding</div>
            <div class="filter-category" data-category="cybersecurity">Cybersecurity</div>
            <div class="filter-category" data-category="ai-tools">AI/ML Tools</div>
            <div class="filter-category" data-category="fintech">FinTech</div>
            <div class="filter-category" data-category="friendly-design">Friendly Design</div>
            <div class="filter-category" data-category="professional-design">Professional</div>
            <div class="filter-category" data-category="creative-design">Creative</div>
            <div class="filter-category" data-category="angel-investors">Angel Investors</div>
            <div class="filter-category" data-category="pitch-deck">Pitch Decks</div>
            <div class="filter-category" data-category="vibrant-design">Vibrant Design</div>
            <div class="filter-category" data-category="minimal-design">Minimal Design</div>
        </div>

        <div class="portfolio-grid" id="portfolio-grid">
            <!-- Portfolio items will be loaded dynamically -->
        </div>
    </section>

    <!-- About Section -->
            <!-- (skills carousel removed from this top location; it will appear below Work & UI Experience) -->

    <section id="about" class="section">
        <h2 class="section-title">About Me</h2>
        <div class="about-content">
            <p id="about-detailed-bio"></p>
            <p id="about-additional-bio"></p>
            <div id="about-skill-chips" class="skill-chips" aria-hidden="false"></div>

            <!-- Cards carousel: rendered from PERSONAL_INFO.cards -->
            <div class="cards-section" style="margin-top:1.5rem;">
                <h3 class="section-subtitle" style="margin-bottom:0.75rem;">Work & UI Experience</h3>
                <div id="about-cards-carousel" class="cards-carousel" tabindex="0" role="list" aria-label="Companies and UI experience"></div>
            </div>

            <div class="cards-section" style="margin-top:1.25rem;">
                <h3 class="section-subtitle" style="margin-bottom:0.75rem;">Skill Categories</h3>
                <div id="skills-cards-carousel" class="cards-carousel" tabindex="0" role="list" aria-label="Skill categories carousel"></div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="section">
        <h2 class="section-title">Get In Touch</h2>
        <div class="about-content">
            <p>
                Interested in collaboration, have a project in mind, or just want to chat 
                about technology and design? I'd love to hear from you!
            </p>
            <div style="margin-top: 2rem;">
                <a id="contact-email-cta" class="social-btn" style="background: linear-gradient(135deg, #0ea5e9, #1e40af); border: none;">
                    <i class="fas fa-envelope"></i> Email Me
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p id="footer-copyright"></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">
            Built with HTML, CSS, and lots of â˜•
        </p>
    </footer>

    <script>
        // Function to update personal information throughout the page
        function updatePersonalInfo() {
            // Update page title
            document.title = `${PERSONAL_INFO.name} - Portfolio`;
            
            // Update header name (prefer explicit ID; fallback to existing selector)
            const headerName = document.getElementById('personal-name') || document.querySelector('.header h1');
            if (headerName) headerName.textContent = PERSONAL_INFO.name;
            
            // Update header subtitle and description (prefer explicit IDs)
            const headerSubtitle = document.getElementById('personal-title') || document.querySelector('.header .subtitle');
            if (headerSubtitle) headerSubtitle.textContent = PERSONAL_INFO.title;

            const headerDesc = document.getElementById('personal-description') || document.querySelector('.header .description');
            if (headerDesc) headerDesc.textContent = PERSONAL_INFO.bio.short;
            
            // Update about section detailed and additional bios (prefer IDs)
            const aboutDetailed = document.getElementById('about-detailed-bio');
            if (aboutDetailed) {
                // Clear and render paragraphs for improved readability
                aboutDetailed.innerHTML = '';
                const paras = (PERSONAL_INFO.bio && PERSONAL_INFO.bio.paragraphs) || [];
                paras.forEach(p => {
                    const el = document.createElement('p');
                    el.textContent = p;
                    aboutDetailed.appendChild(el);
                });
            }

            
            const aboutAdditional = document.getElementById('about-additional-bio');
            if (aboutAdditional) aboutAdditional.textContent = PERSONAL_INFO.bio.additional;
            
            // Update email and social links via explicit IDs
            const emailLink = document.getElementById('email-link');
            if (emailLink) {
                emailLink.href = `mailto:${PERSONAL_INFO.email}`;
                emailLink.setAttribute('aria-label', `Email ${PERSONAL_INFO.name}`);
            }

            const contactEmailCta = document.getElementById('contact-email-cta');
            if (contactEmailCta) {
                contactEmailCta.href = `mailto:${PERSONAL_INFO.email}`;
                contactEmailCta.setAttribute('aria-label', `Email ${PERSONAL_INFO.name}`);
            }

            const linkedinLink = document.getElementById('linkedin-link');
            if (linkedinLink) {
                linkedinLink.href = PERSONAL_INFO.social.linkedin;
            }

            const githubLink = document.getElementById('github-link');
            if (githubLink) {
                githubLink.href = PERSONAL_INFO.social.github;
            }

            const bioLink = document.getElementById('bio-page-link');
            if (bioLink) {
                bioLink.href = PERSONAL_INFO.social.bioPage;
            }
            
            // Update footer copyright (use current year)
            const footerCopyright = document.getElementById('footer-copyright') || document.querySelector('.footer p');
            if (footerCopyright) {
                const year = new Date().getFullYear();
                footerCopyright.textContent = `Â© ${year} ${PERSONAL_INFO.name}. All rights reserved.`;
            }
            
            // Update stats via explicit IDs
            const statExperience = document.getElementById('stat-experience');
            if (statExperience) statExperience.textContent = PERSONAL_INFO.stats.experience;
            const statDesign = document.getElementById('stat-design-variations');
            if (statDesign) statDesign.textContent = PERSONAL_INFO.stats.designVariations;
            const statCompanies = document.getElementById('stat-companies');
            if (statCompanies) statCompanies.textContent = PERSONAL_INFO.stats.companies;
            const statDevices = document.getElementById('stat-devices');
            if (statDevices) statDevices.textContent = PERSONAL_INFO.stats.devicesSecured;

            // Render skill chips under About
            const aboutChips = document.getElementById('about-skill-chips');
            if (aboutChips && Array.isArray(PERSONAL_INFO.skills)) {
                aboutChips.innerHTML = PERSONAL_INFO.skills.map(s => `<span class="skill-chip">${s.name}</span>`).join('');
            }

            // Render related skills under stat cards if available
            const related = PERSONAL_INFO.stats && PERSONAL_INFO.stats.related ? PERSONAL_INFO.stats.related : {};
            const statMap = {
                experience: 'stat-experience-skills',
                designVariations: 'stat-design-skills',
                companies: 'stat-companies-skills',
                devicesSecured: 'stat-devices-skills'
            };

            Object.keys(statMap).forEach(key => {
                const el = document.getElementById(statMap[key]);
                if (!el) return;
                const names = related[key] || [];
                el.innerHTML = names.map(n => `<span class="skill-chip">${n}</span>`).join('');
            });
        }

        // Helper function to create individual portfolio card
        function createPortfolioCard(project) {
            const card = document.createElement('div');
            card.className = 'portfolio-card';
            card.setAttribute('data-categories', project.category.join(' '));
            card.setAttribute('data-tags', project.tags.join(' ').toLowerCase());
            card.setAttribute('data-title', project.title.toLowerCase());
            
            const linkHTML = `<a href="${project.url}" class="portfolio-link" target="_blank">
                View Design <i class="fas fa-arrow-right"></i>
            </a>`;
            
            const tagsHTML = project.tags.map(tag => 
                `<span class="tag">${tag}</span>`
            ).join('');
            
        const thumbnailContent = project.screenshot ? 
            `<img src="${project.screenshot}" alt="${project.title} Screenshot" 
                onerror="this.onerror=null; this.style.display='none'; this.setAttribute('aria-hidden','true');">` :
            `<div aria-hidden="true" class="thumbnail-placeholder"><i class="${project.icon}"></i></div>`;
            
            const designBadges = [];
            if (project.targetAudience) designBadges.push(`<span class="design-badge audience">ðŸ‘¥ ${project.targetAudience}</span>`);
            if (project.designStyle) designBadges.push(`<span class="design-badge style">ðŸŽ¨ ${project.designStyle}</span>`);
            if (project.colorScheme) designBadges.push(`<span class="design-badge color">ðŸŽ¨ ${project.colorScheme}</span>`);
            
            card.innerHTML = `
                <div class="portfolio-thumbnail">
                    ${thumbnailContent}
                </div>
                <div class="portfolio-content">
                    <h3 class="portfolio-title">${project.title}</h3>
                    <p class="portfolio-description">${project.description}</p>
                    ${designBadges.length > 0 ? `<div class="design-badges">${designBadges.join('')}</div>` : ''}
                    <div class="portfolio-tags">
                        ${tagsHTML}
                    </div>
                    <div class="portfolio-links">
                        ${linkHTML}
                    </div>
                </div>
            `;

            // Make the entire card clickable (open project URL in a new tab) while preserving
            // inner link behavior. Do not change visible styling; this adds behavior only.
            card.tabIndex = 0; // make focusable
            card.setAttribute('role', 'link');
            card.addEventListener('click', (e) => {
                // If the user clicked an actual anchor or interactive element inside, let it handle the event
                if (e.target.closest('a') || e.target.closest('button')) return;
                // Open project detail modal instead of navigating away
                openProjectModal(project);
            });
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    // Space/Enter should open the link (mirror click behavior)
                    e.preventDefault();
                    try { window.open(project.url, '_blank'); }
                    catch (err) { window.location.href = project.url; }
                }
            });

            return card;
        }

        // Modal population and behavior
        let _lastFocusedCard = null;
        // Helper to mark main page content as inert/aria-hidden while modal is open
        function setPageInert(shouldBeInert) {
            const modal = document.getElementById('project-modal');
            Array.from(document.body.children).forEach(child => {
                if (child === modal) return;
                try {
                    if (shouldBeInert) {
                        child.setAttribute('aria-hidden', 'true');
                        // set inert if supported or harmless to set
                        try { child.inert = true; } catch (e) { child.setAttribute('inert', ''); }
                    } else {
                        child.removeAttribute('aria-hidden');
                        try { child.inert = false; } catch (e) { child.removeAttribute('inert'); }
                    }
                } catch (e) {
                    // ignore per-element failures
                }
            });
        }
        function openProjectModal(project) {
            const modal = document.getElementById('project-modal');
            const img = modal.querySelector('.modal-body-img');
            const title = modal.querySelector('.modal-title');
            const desc = modal.querySelector('.modal-description');
            const challenge = modal.querySelector('.modal-challenge');
            const approach = modal.querySelector('.modal-approach');
            const outcome = modal.querySelector('.modal-outcome');
            const tags = modal.querySelector('.modal-tags');

            title.textContent = project.title || '';
            desc.textContent = project.description || '';
            img.src = project.screenshot || '';
            img.alt = (project.title || 'Project') + ' screenshot';
            challenge.textContent = project.challenge || 'No challenge description provided.';
            approach.textContent = project.approach || 'No approach details provided.';
            outcome.textContent = project.outcome || 'No outcome or metrics provided.';

            // Populate tags under the image (thumbnail tags) and set CTA links
            const thumbTagsEl = modal.querySelector('.thumbnail-tags');
            if (thumbTagsEl) thumbTagsEl.innerHTML = (project.tags || []).map(t => `<span class="tag">${t}</span>`).join('');
            const cta = document.getElementById('modal-cta');
            if (cta) cta.href = project.url || '#';

            // Keep modal tags (for backward compatibility) empty to avoid duplication
            if (tags) tags.innerHTML = '';

            modal.setAttribute('aria-hidden', 'false');
            // Mark the rest of the page inert so assistive tech ignores underlying content
            setPageInert(true);
            // trap focus lightly by focusing close button
            _lastFocusedCard = document.activeElement && document.activeElement.closest && document.activeElement.closest('.portfolio-card') ? document.activeElement.closest('.portfolio-card') : null;
            const closeBtn = modal.querySelector('.modal-close');
            if (closeBtn) closeBtn.focus();

            // light focus trap: intercept Tab navigation within modal
            modal.addEventListener('keydown', modalKeyHandler);

            // If focus-trap was loaded from CDN, try to create and activate it for robust trapping
            try {
                const createTrap = window.createFocusTrap || (window.focusTrap && window.focusTrap.createFocusTrap) || null;
                if (createTrap) {
                    // create trap on the modal content
                    _focusTrapInstance = createTrap(modal.querySelector('.modal-content'), {
                        escapeDeactivates: false,
                        clickOutsideDeactivates: true,
                        allowOutsideClick: true
                    });
                    _focusTrapInstance && _focusTrapInstance.activate && _focusTrapInstance.activate();
                }
            } catch (e) {
                // fallback: rely on simple keyboard handler above
                console.log('Focus-trap activation failed, falling back to lightweight trap');
            }
            // Populate tab panels with quick content
            populateModalPanels(project);
        }

        function closeProjectModal() {
            const modal = document.getElementById('project-modal');
            if (!modal) return;
            modal.setAttribute('aria-hidden', 'true');
            // remove src to stop any playing media
            const img = modal.querySelector('.modal-body-img');
            if (img) img.src = '';
            // remove trap
            modal.removeEventListener('keydown', modalKeyHandler);
            // deactivate focus-trap if active
            try {
                if (_focusTrapInstance && _focusTrapInstance.deactivate) {
                    _focusTrapInstance.deactivate();
                }
            } catch (e) {
                // ignore
            }
            _focusTrapInstance = null;
            // restore page inert state
            setPageInert(false);
            // restore focus to previously focused card
            if (_lastFocusedCard) {
                try { _lastFocusedCard.focus(); } catch (e) {}
                _lastFocusedCard = null;
            }
        }

        function modalKeyHandler(e) {
            if (e.key !== 'Tab') return;
            const modal = document.getElementById('project-modal');
            const focusable = modal.querySelectorAll('a, button, [tabindex]:not([tabindex="-1"])');
            if (!focusable.length) return;
            const first = focusable[0];
            const last = focusable[focusable.length - 1];
            if (e.shiftKey && document.activeElement === first) {
                e.preventDefault(); last.focus();
            } else if (!e.shiftKey && document.activeElement === last) {
                e.preventDefault(); first.focus();
            }
        }

        // Reusable carousel behavior: drag-to-scroll, keyboard navigation, autoplay with pause/resume
        function applyCarouselBehavior(carousel, options = {}) {
            if (!carousel) return;
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            let isDragging = false;
            let startX = 0, scrollLeft = 0;
            let rafId = null, lastTime = null, direction = 1;
            const speed = options.speed || 18; // pixels per second (slower)
            let resumeTimer = null;
            // float accumulator to avoid losing fractional increments
            let floatScroll = null;

            function onPointerDown(e) {
                isDragging = true;
                carousel.classList.add('dragging');
                startX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
                scrollLeft = carousel.scrollLeft;
                floatScroll = carousel.scrollLeft;
                try { carousel.setPointerCapture && carousel.setPointerCapture(e.pointerId); } catch (err) {}
                stopAutoplay();
                cancelResume();
            }

            function onPointerMove(e) {
                if (!isDragging) return;
                const x = e.clientX || (e.touches && e.touches[0].clientX) || 0;
                const dx = x - startX;
                carousel.scrollLeft = scrollLeft - dx;
            }

            function stopDragging(e) {
                isDragging = false;
                try { carousel.releasePointerCapture && carousel.releasePointerCapture(e.pointerId); } catch (err) {}
                carousel.classList.remove('dragging');
                scheduleResume(1400);
                // sync accumulator after user interaction
                floatScroll = carousel.scrollLeft;
            }

            function onKeyDown(e) {
                const key = e.key;
                const cardWidth = carousel.querySelector('.card-item')?.offsetWidth || 320;
                if (key === 'ArrowRight') {
                    carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
                    e.preventDefault();
                } else if (key === 'ArrowLeft') {
                    carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
                    e.preventDefault();
                }
            }

            let _lastLog = 0;
            function animateFrame(timestamp) {
                if (!lastTime) lastTime = timestamp;
                const dt = (timestamp - lastTime) / 1000;
                lastTime = timestamp;
                if (!isDragging) {
                    const maxScroll = carousel.scrollWidth - carousel.clientWidth;
                    if (maxScroll > 1) {
                        if (floatScroll === null) floatScroll = carousel.scrollLeft;
                        const change = direction * speed * dt;
                        floatScroll += change;
                        // clamp
                        if (floatScroll <= 0) { floatScroll = 0; direction = 1; }
                        else if (floatScroll >= maxScroll) { floatScroll = maxScroll; direction = -1; }
                        // assign using scrollTo to ensure rendering
                        try { carousel.scrollTo({ left: floatScroll, behavior: 'auto' }); } catch (e) { carousel.scrollLeft = floatScroll; }
                    }
                }
                // no diagnostic logging here in production
                rafId = requestAnimationFrame(animateFrame);
            }

            const _originalSnap = (carousel.style && carousel.style.scrollSnapType) || window.getComputedStyle(carousel).getPropertyValue('scroll-snap-type') || '';
            function startAutoplay() {
                if (prefersReducedMotion) return;
                stopAutoplay();
                // temporarily disable snap to allow smooth RAF-driven scrolling
                try { carousel.style.scrollSnapType = 'none'; } catch (e) {}
                lastTime = null;
                rafId = requestAnimationFrame(animateFrame);
            }

            function stopAutoplay() {
                if (rafId) { cancelAnimationFrame(rafId); rafId = null; lastTime = null; }
                // restore original snap behavior
                try { carousel.style.scrollSnapType = _originalSnap || ''; } catch (e) {}
            }

            function scheduleResume(delay = 1500) {
                if (resumeTimer) clearTimeout(resumeTimer);
                resumeTimer = setTimeout(() => { startAutoplay(); resumeTimer = null; }, delay);
            }

            function cancelResume() { if (resumeTimer) { clearTimeout(resumeTimer); resumeTimer = null; } }

            // Pointer events
            carousel.addEventListener('pointerdown', onPointerDown);
            carousel.addEventListener('pointermove', onPointerMove);
            carousel.addEventListener('pointerup', stopDragging);
            carousel.addEventListener('pointercancel', stopDragging);
            carousel.addEventListener('pointerleave', stopDragging);

            // Pause on hover/focus and resume after idle
            carousel.addEventListener('mouseenter', () => { stopAutoplay(); cancelResume(); });
            carousel.addEventListener('focusin', () => { stopAutoplay(); cancelResume(); });
            carousel.addEventListener('mouseleave', () => { scheduleResume(1200); });
            carousel.addEventListener('focusout', () => { scheduleResume(1200); });

            // Keyboard
            carousel.addEventListener('keydown', onKeyDown);

            // Start autoplay
            if (!prefersReducedMotion) startAutoplay();

            return {
                start: startAutoplay,
                stop: stopAutoplay
            };
        }

        // Render skill categories into the skills carousel and apply carousel behavior
        function renderSkillsCarousel(categories) {
            const container = document.getElementById('skills-cards-carousel');
            if (!container) return;
            // Use the container itself if it already is the carousel element
            let carousel = container.classList.contains('cards-carousel') ? container : container.querySelector('.cards-carousel');
            if (!carousel) {
                carousel = document.createElement('div');
                carousel.className = 'cards-carousel';
                carousel.tabIndex = 0;
                carousel.setAttribute('role', 'list');
                container.appendChild(carousel);
            }
            carousel.innerHTML = '';

            categories.forEach(cat => {
                const item = document.createElement('article');
                item.className = 'card-item skill-category-card';
                item.setAttribute('role', 'listitem');

                const title = document.createElement('h3');
                title.className = 'skill-category-title';
                title.textContent = cat.title;

                const ul = document.createElement('ul');
                ul.className = 'skill-items';
                (cat.items || []).forEach(s => {
                    const li = document.createElement('li');
                    li.className = 'skill-item';
                    li.textContent = s;
                    ul.appendChild(li);
                });

                item.appendChild(title);
                item.appendChild(ul);
                carousel.appendChild(item);
            });

            applyCarouselBehavior(carousel, { speed: 18 });
        }

        // Enhanced portfolio card generation with screenshot support
        async function generatePortfolioCards() {
            const grid = document.getElementById('portfolio-grid');
            grid.innerHTML = ''; // Clear existing cards
            
            // Load projects from Portfolio Manager
            const projects = await portfolioManager.loadProjects();
            
            projects.forEach(project => {
                const card = createPortfolioCard(project);
                grid.appendChild(card);
            });
            
            // Reinitialize filters after cards are generated
            setupFilters();
        }

        // Filter functionality
        function setupFilters() {
            const searchInput = document.getElementById('search-input');
            const categoryButtons = document.querySelectorAll('.filter-category');
            // const portfolioCards = document.querySelectorAll('.portfolio-card'); // unused
            
            let activeCategory = 'all';
            
            // Category filter
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    activeCategory = button.getAttribute('data-category');
                    filterProjects();
                });
            });
            
            // Search filter
            searchInput.addEventListener('input', filterProjects);
            
            function filterProjects() {
                const searchTerm = searchInput.value.toLowerCase();
                const grid = document.getElementById('portfolio-grid');
                
                // Get all projects data
                const allProjects = portfolioManager.projects || [];
                
                // Filter projects that match criteria
                const matchingProjects = allProjects.filter(project => {
                    const matchesCategory = activeCategory === 'all' || 
                        (project.category && project.category.includes(activeCategory));
                    const matchesSearch = !searchTerm || 
                        project.title.toLowerCase().includes(searchTerm) ||
                        project.description.toLowerCase().includes(searchTerm) ||
                        project.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                    
                    return matchesCategory && matchesSearch;
                });
                
                // Clear grid and regenerate with filtered projects only
                grid.innerHTML = '';
                
                matchingProjects.forEach(project => {
                    const card = createPortfolioCard(project);
                    grid.appendChild(card);
                });
            }
        }

        // Store reference to portfolioManager in setupFilters
        // setupFilters.portfolioManager = portfolioManager;

        // Enhanced Automatic Portfolio Detection System
        class PortfolioManager {
            constructor() {
                this.projects = [];
                this.categories = [];
                this.initialized = false;
            }

            async autoDetectProjects() {
                try {
                    // Try to load from registry first (auto-generated)
                    console.log('Loading portfolio from registry...');
                    const response = await fetch('js/portfolio-registry.json');
                    if (response.ok) {
                        const registry = await response.json();
                        console.log('Registry loaded successfully:', registry.projects.length, 'projects');
                        return registry.projects;
                    } else {
                        console.log('Registry fetch failed with status:', response.status);
                    }
                } catch (error) {
                    console.log('Registry fetch error:', error.message);
                }

                try {
                    // Fallback to static portfolio data
                    console.log('Trying portfolio-data.js fallback...');
                    const dataResponse = await fetch('js/portfolio-data.js');
                    if (dataResponse.ok) {
                        console.log('portfolio-data.js loaded, checking for portfolioData...');
                        // Try to access portfolioData from the loaded script
                        if (typeof portfolioData !== 'undefined' && portfolioData.projects) {
                            console.log('Using portfolioData.projects:', portfolioData.projects.length, 'projects');
                            return portfolioData.projects;
                        } else {
                            console.log('portfolioData not found in global scope');
                        }
                    } else {
                        console.log('portfolio-data.js fetch failed with status:', dataResponse.status);
                    }
                } catch (error) {
                    console.log('Portfolio data fetch error:', error.message);
                }

                // Check if the registry file exists by trying a different approach
                console.log('Trying direct registry check...');
                try {
                    const registryCheck = await fetch('./js/portfolio-registry.json');
                    if (registryCheck.ok) {
                        const registryData = await registryCheck.json();
                        console.log('Direct registry check successful:', registryData.projects.length, 'projects');
                        return registryData.projects;
                    }
                } catch (error) {
                    console.log('Direct registry check failed:', error.message);
                }

                // Final fallback with helpful diagnostic message
                console.log('All loading methods failed, using error fallback');
                return [
                    {
                        id: 'loading-failed',
                        title: 'Portfolio Loading Failed',
                        description: 'Unable to load portfolio data. Please check browser console for details and ensure js/portfolio-registry.json exists and is accessible.',
                        icon: 'fas fa-exclamation-triangle',
                        tags: ['Error', 'Loading Failed'],
                        category: ['system'],
                        url: '#',
                        targetAudience: 'Debug Info',
                        designStyle: 'Error State',
                        colorScheme: 'Error Red'
                    },
                    {
                        id: 'check-files',
                        title: 'Check Configuration Files',
                        description: 'Ensure these files exist: 1) js/portfolio-registry.json with project data, 2) js/portfolio-data.js as fallback. Check browser Network tab for 404 errors.',
                        icon: 'fas fa-tools',
                        tags: ['Configuration', 'Debug', 'Setup'],
                        category: ['system'],
                        url: '#',
                        targetAudience: 'Developer',
                        designStyle: 'Debug Helper',
                        colorScheme: 'Warning Orange'
                    }
                ];
            }

            async loadProjects() {
                if (this.initialized) {
                    return this.projects;
                }

                this.projects = await this.autoDetectProjects();
                this.initialized = true;
                
                console.log(`Portfolio Manager: Loaded ${this.projects.length} projects`);
                
                // Update stats
                this.updateStats();
                
                return this.projects;
            }

            updateStats() {
                const statElement = document.querySelector('.stat-card .stat-number');
                if (statElement && statElement.textContent.includes('+')) {
                    // Update the project count in the stats
                    const projectCount = this.projects.length;
                    const statsCards = document.querySelectorAll('.stat-number');
                    if (statsCards.length >= 2) {
                        statsCards[1].textContent = `${projectCount}+`;
                    }
                }
            }

            

            getProjectsByCategory(category) {
                if (category === 'all') {
                    return this.projects;
                }
                return this.projects.filter(project => 
                    project.category && project.category.includes(category)
                );
            }

            searchProjects(searchTerm) {
                if (!searchTerm) {
                    return this.projects;
                }
                
                const term = searchTerm.toLowerCase();
                return this.projects.filter(project => 
                    project.title.toLowerCase().includes(term) ||
                    project.description.toLowerCase().includes(term) ||
                    project.tags.some(tag => tag.toLowerCase().includes(term))
                );
            }
        }

        // Initialize Portfolio Manager
        const portfolioManager = new PortfolioManager();

        // Navigation behavior and scroll-spy will be set up by setupNavScrollSpy()

        // (debugFileAccess removed - diagnostics cleaned for production)

        

        // Enhanced initialization with loading states
        document.addEventListener('DOMContentLoaded', async () => {
            // Update personal information from single source
            updatePersonalInfo();
            // Delegate clicks for navigation links to ensure smooth scrolling works
            // across browsers and elements (do not change visible .active classes here).
            document.addEventListener('click', function (e) {
                const link = e.target.closest && e.target.closest('.nav-link');
                if (!link) return;
                const href = link.getAttribute('href') || '';
                if (href.startsWith('#')) {
                    const target = document.querySelector(href);
                    if (!target) return;
                    e.preventDefault();
                    // Compute scroll offset to account for sticky nav height so the section isn't hidden.
                    const navEl = document.querySelector('.nav');
                    const navHeight = (navEl && navEl.offsetHeight) ? navEl.offsetHeight : 96;
                    const rect = target.getBoundingClientRect();
                    const targetY = Math.max(0, window.scrollY + rect.top - navHeight - 8);
                    try {
                        window.scrollTo({ top: targetY, behavior: 'smooth' });
                    } catch (err) {
                        // fallback
                        window.scrollTo(0, targetY);
                    }
                }
            }, false);
            
            // debug checks removed in production build
            
            // Show loading state
            const grid = document.getElementById('portfolio-grid');
            grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #0ea5e9; margin-bottom: 1rem;"></i>
                    <p style="color: #64748b; font-size: 1.1rem;">Loading portfolio projects...</p>
                    <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 1rem;">Check browser console for loading details</p>
                </div>
            `;
            
            try {
                // Load and generate portfolio cards
                await generatePortfolioCards();
                // Layout changed after generating cards â€” if you add scroll-spy later, recompute offsets here.
                console.log('Portfolio loaded successfully');
            } catch (error) {
                console.error('Error loading portfolio:', error);
                
                // Show detailed error state
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #ef4444; margin-bottom: 1rem;"></i>
                        <p style="color: #64748b; font-size: 1.1rem;">Error loading portfolio</p>
                        <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 1rem;">Check browser console for details. Error: ${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #0ea5e9; color: white; border: none; border-radius: 0.5rem; cursor: pointer;">
                            Retry Loading
                        </button>
                    </div>
                `;
            }

            // Render company cards carousel from PERSONAL_INFO.cards
            function renderCardsCarousel() {
                const carousel = document.getElementById('about-cards-carousel');
                if (!carousel || !Array.isArray(PERSONAL_INFO.cards)) return;

                carousel.innerHTML = PERSONAL_INFO.cards.map(card => `
                    <article class="card-item" role="listitem" tabindex="0" data-id="${card.id}">
                        <div class="card-company">${card.company}</div>
                        <div class="card-role">${card.role}</div>
                        <div class="card-summary">${card.summary}</div>
                        <div class="card-tags">
                            ${card.uiTags.map(t => `<span class="card-tag">${t}</span>`).join('')}
                        </div>
                    </article>
                `).join('');

                // Apply generic carousel behavior (drag, keyboard, autoplay, pause/resume)
                applyCarouselBehavior(carousel);
            }

            // Render after personal info updated
            renderCardsCarousel();
            // Populate the skills carousel (below the company carousel)
            if (Array.isArray(PERSONAL_INFO.skillCategories)) {
                renderSkillsCarousel(PERSONAL_INFO.skillCategories);
            }
        });
    </script>

        <!-- Project Detail Modal -->
        <div id="project-modal" class="modal" role="dialog" aria-hidden="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
            <div class="modal-overlay" tabindex="-1" onclick="closeProjectModal()"></div>
            <div class="modal-content">
                    <button class="modal-close" aria-label="Close details" onclick="closeProjectModal()">&times;</button>
                    <div class="modal-body" aria-hidden="false">
                        <img class="modal-body-img" src="" alt="project screenshot" />
                        <!-- Thumbnail meta: tags only (CTA moved to floating button) -->
                        <div class="thumbnail-meta" style="margin-top:0.75rem; display:flex; align-items:center; justify-content:flex-start; gap:0.75rem;">
                            <div class="thumbnail-tags" style="display:flex; gap:0.4rem; flex-wrap:wrap; align-items:center;"></div>
                        </div>
                    </div>
                    <div class="modal-details" role="region" aria-label="Project details panel">
                        <div class="modal-header" style="display:flex; align-items:flex-start; justify-content:space-between; gap:1rem;">
                            <h3 id="modal-title" class="modal-title" style="flex:1;"> </h3>
                            <!-- Primary CTA relocated to a single floating button at the bottom-right -->
                            <div style="margin-left:1rem; visibility:hidden; width:1px; height:1px;"> </div>
                        </div>

                        <!-- Tabbed content: Overview / Case Study / Details -->
                        <!-- Tabs moved to top for quick access -->
                        <div class="tab-list" role="tablist" aria-label="Project sections">
                            <button class="tab" role="tab" aria-selected="true" tabindex="0" data-tab="overview">Overview</button>
                            <button class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="case">Case Study</button>
                            <button class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="facts">Quick Facts</button>
                        </div>

                        <div class="tab-panels">
                            <section class="tab-panel" data-tab="overview" data-active="true" role="tabpanel">
                                <div class="modal-details-content">
                                    <div class="panel-overview">
                                        <!-- Overview contains the short description -->
                                        <p id="modal-desc" class="modal-description" style="color:#475569; margin-bottom:0.75rem;"></p>
                                        <div class="panel-actions modal-actions">
                                            <!-- CTA removed from Overview to avoid duplication; primary CTA sits below the tabs -->
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <section class="tab-panel" data-tab="case" role="tabpanel" hidden>
                                <div class="modal-details-content">
                                    <h4>Challenge</h4>
                                    <p class="modal-challenge clamp-3" style="color:#475569"></p>
                                    <button class="read-more-toggle" data-target=".modal-challenge">Read more</button>
                                    <h4 style="margin-top:0.75rem">Approach</h4>
                                    <p class="modal-approach clamp-3" style="color:#475569"></p>
                                    <button class="read-more-toggle" data-target=".modal-approach">Read more</button>
                                    <h4 style="margin-top:0.75rem">Outcome</h4>
                                    <p class="modal-outcome clamp-3" style="color:#475569"></p>
                                    <button class="read-more-toggle" data-target=".modal-outcome">Read more</button>
                                </div>
                            </section>

                            <section class="tab-panel" data-tab="facts" role="tabpanel" hidden>
                                <div class="modal-details-content">
                                    <h4>Quick Facts</h4>
                                    <div class="panel-facts" style="color:#475569"></div>
                                    <h4 style="margin-top:1rem">Notes</h4>
                                    <div class="panel-notes" style="color:#475569"></div>
                                </div>
                            </section>
                        </div>

                        <!-- Modal footer: persistent button row visible outside tab panels -->
                        <div class="modal-footer" id="modal-footer">
                            <a id="modal-cta" class="modal-cta" target="_blank" href="#" aria-label="Open mock (opens in new tab)">
                                Open Mock <span style="font-size:0.95rem;">â†—</span>
                            </a>
                        </div>
                    </div>
                </div>
        </div>

        <script>
            // Wire up modal close on Escape and set modal open link behavior
            document.addEventListener('keydown', (e) => {
                const modal = document.getElementById('project-modal');
                if (!modal) return;
                if (e.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') {
                    closeProjectModal();
                }
            });

            // Update modal open link dynamically when opened
            const originalOpenProjectModal = window.openProjectModal;
            // After modal is opened we set the open link's href
            const observer = new MutationObserver(() => {
                const modal = document.getElementById('project-modal');
                if (!modal) return;
                if (modal.getAttribute('aria-hidden') === 'false') {
                    const title = modal.querySelector('.modal-title').textContent || '';
                    // Find the project in portfolioManager by title
                    const proj = portfolioManager.projects && portfolioManager.projects.find(p => p.title === title);
                    const cta = document.getElementById('modal-cta');
                    if (proj && cta) {
                        cta.href = proj.url || '#';
                    }
                }
            });
            observer.observe(document.getElementById('project-modal'), { attributes: true, attributeFilter: ['aria-hidden'] });

            // Attempt to load focus-trap from CDN for robust focus management. If it loads,
            // we'll use it; otherwise we fall back to the lightweight trap already implemented.
            let _focusTrapInstance = null;
            (function loadFocusTrap() {
                const s = document.createElement('script');
                s.src = 'https://unpkg.com/focus-trap@6.9.3/dist/focus-trap.umd.js';
                s.crossorigin = 'anonymous';
                s.onload = () => { /* focus-trap will be available as window.focusTrap */ };
                s.onerror = () => { /* ignore - fallback will be used */ };
                document.head.appendChild(s);
            })();

            // Tab handling and panel population for the modal
            function populateModalPanels(project) {
                const modal = document.getElementById('project-modal');
                if (!modal) return;
                // Populate case study fields
                modal.querySelector('.modal-challenge').textContent = project.challenge || 'No challenge description provided.';
                modal.querySelector('.modal-approach').textContent = project.approach || 'No approach details provided.';
                modal.querySelector('.modal-outcome').textContent = project.outcome || 'No outcome or metrics provided.';

                // Populate overview description (moved into Overview tab)
                const descEl = modal.querySelector('#modal-desc');
                if (descEl) descEl.textContent = project.description || '';

                // Quick facts: tags, category, folder, variants
                const facts = [];
                if (project.category) facts.push('Category: ' + project.category.join(', '));
                if (project.folder) facts.push('Folder: ' + project.folder);
                if (project.variants) facts.push('Variants: ' + project.variants.map(v => v.name || v.folder).slice(0,3).join(', '));
                modal.querySelector('.panel-facts').textContent = facts.join(' â€¢ ');

                // Notes (small description)
                modal.querySelector('.panel-notes').textContent = project.description || '';

                // Switch to first tab (overview)
                activateTab('overview');

                // Attach read-more toggle behavior for case study sections
                const toggles = modal.querySelectorAll('.read-more-toggle');
                toggles.forEach(btn => {
                    btn.setAttribute('aria-expanded', 'false');
                    btn.addEventListener('click', (e) => {
                        const targetSelector = btn.getAttribute('data-target');
                        if (!targetSelector) return;
                        const target = modal.querySelector(targetSelector);
                        if (!target) return;
                        const expanded = btn.getAttribute('aria-expanded') === 'true';
                        if (expanded) {
                            // collapse
                            target.classList.add('clamp-3');
                            btn.textContent = 'Read more';
                            btn.setAttribute('aria-expanded', 'false');
                        } else {
                            // expand
                            target.classList.remove('clamp-3');
                            btn.textContent = 'Show less';
                            btn.setAttribute('aria-expanded', 'true');
                        }
                    });
                });
            }

            function activateTab(tabName) {
                const modal = document.getElementById('project-modal');
                if (!modal) return;
                const tabs = modal.querySelectorAll('.tab');
                tabs.forEach(t => {
                    const is = t.dataset.tab === tabName;
                    t.setAttribute('aria-selected', is ? 'true' : 'false');
                    t.tabIndex = is ? 0 : -1;
                });
                const panels = modal.querySelectorAll('.tab-panel');
                panels.forEach(p => {
                    if (p.dataset.tab === tabName) { p.hidden = false; p.setAttribute('data-active','true'); }
                    else { p.hidden = true; p.removeAttribute('data-active'); }
                });
            }

            // Wire up tab clicks and keyboard navigation
            document.addEventListener('click', (e) => {
                const t = e.target.closest && e.target.closest('.tab');
                if (!t) return;
                const tab = t.dataset.tab;
                activateTab(tab);
                t.focus();
            });

            document.addEventListener('keydown', (e) => {
                const focused = document.activeElement;
                if (!focused || !focused.classList.contains('tab')) return;
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                    const modal = document.getElementById('project-modal');
                    const tabs = Array.from(modal.querySelectorAll('.tab'));
                    const idx = tabs.indexOf(focused);
                    let next = idx + (e.key === 'ArrowRight' ? 1 : -1);
                    if (next < 0) next = tabs.length - 1;
                    if (next >= tabs.length) next = 0;
                    tabs[next].focus();
                    activateTab(tabs[next].dataset.tab);
                    e.preventDefault();
                }
            });
        </script>
</body>
</html>